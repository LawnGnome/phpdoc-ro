
VPATH=@srcdir@
srcdir=@srcdir@
JADE=@JADE@ -wno-idref
NSGMLS=@NSGMLS@

CATALOG=@CATALOG@

HTML_STYLESHEET=html.dsl
PHPWEB_STYLESHEET=phpweb.dsl
HOWTO_STYLESHEET=howto.dsl
PRINT_STYLESHEET=print.dsl
QUICKREF_STYLESHEET=quickref.dsl
KDEVELOP_TOC_STYLESHEET=kdevelop_toc.dsl

HTML_DEPS=$(HTML_STYLESHEET) common.dsl
PHPWEB_DEPS=$(PHPWEB_STYLESHEET) common.dsl

all: html

html.dsl: $(srcdir)/html.dsl.in ./config.status
	CONFIG_FILES=$@ CONFIG_HEADERS= ./config.status

phpweb.dsl: $(srcdir)/phpweb.dsl.in ./config.status
	CONFIG_FILES=$@ CONFIG_HEADERS= ./config.status

html: html/index.html
phpweb: php/index.php

FORCE:

Makefile: $(srcdir)/Makefile.in ./config.status
	CONFIG_FILES=$@ CONFIG_HEADERS= ./config.status

html/index.html: $(HTML_DEPS)
	@test -d html || mkdir html
	$(JADE) $(CATALOG) -d $(HTML_STYLESHEET) -V use-output-dir -t sgml $(srcdir)/phpdocxml.dcl manual.xml

php/index.php: $(PHPWEB_DEPS)
	@test -d php || mkdir php
	-$(JADE) $(CATALOG) -d $(PHPWEB_STYLESHEET) -V use-output-dir -t sgml $(srcdir)/phpdocxml.dcl manual.xml

# test all possible errors
test: manual.xml
	$(NSGMLS) -i lang-$(LANG) -s $(srcdir)/phpdocxml.dcl $<

# ignore missing IDs and check if the manual can be generated anyway
test_man_gen: manual.xml
	$(NSGMLS) -wno-idref -i lang-$(LANG) -s $(srcdir)/phpdocxml.dcl $<

clean:
	rm -rf html php fancy

distclean: clean
	rm -f Makefile configure html.dsl phpweb.dslconfig.log config.status
